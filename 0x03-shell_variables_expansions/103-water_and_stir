#!/bin/bash

# Correct character mappings
WATER_BASE="water"
STIR_BASE="stir"
BESTCHOL_BASE="shtbeolc"  # <- correct mapping

to_decimal() {
    local input="$1"
    local charset="$2"
    local base=${#charset}
    local result=0
    local power=1
    local len=${#input}

    for (( i=len-1; i>=0; i-- )); do
        char="${input:$i:1}"
        pos=$(expr index "$charset" "$char")
        if [ "$pos" -eq 0 ]; then
            echo "Invalid character '$char' in input '$input'" >&2
            exit 1
        fi
        (( result += (pos - 1) * power ))
        (( power *= base ))
    done

    echo "$result"
}

from_decimal() {
    local number=$1
    local charset="$2"
    local base=${#charset}
    local result=""

    while [ "$number" -gt 0 ]; do
        (( digit = number % base ))
        result="${charset:digit:1}$result"
        (( number /= base ))
    done

    echo "$result"
}

# Main logic
num1=$(to_decimal "$WATER" "$WATER_BASE")
num2=$(to_decimal "$STIR" "$STIR_BASE")
sum=$(( num1 + num2 ))
from_decimal "$sum" "$BESTCHOL_BASE"
